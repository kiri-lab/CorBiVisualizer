/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package corbivisualizer;

import java.io.*;
import java.nio.charset.Charset;

import javafx.application.Application;
import javafx.scene.*;
import javafx.stage.Stage;
import javafx.scene.shape.*;
import corbivisualizer.communication.*;
import corbivisualizer.ui.*;
import java.util.*;
import corbivisualizer.ui.Gauge;

public class App extends Application
{

    private List<Gauge> gauges = new ArrayList<>();

    @Override
    public void start(Stage stage)
    {
        Group root = new Group();
        // TODO この辺のプロパティ、どっかでまとめて定義しておいてくだちい
        Scene scene = new Scene(root, 800, 600);
        //DynamicBar dynamicBar = new DynamicBar(400, 300, 90, 100, 10);
        DynamicBar dynamicBar = new DynamicBar();
        dynamicBar.setX(0).setY(10).setAngle(270).setWidth(10);
        root.getChildren().add(dynamicBar);
        gauges.add(dynamicBar);

        DynamicCircle dynamicCircle = new DynamicCircle(200, 200, 0, 100, 100, 90);
        root.getChildren().add(dynamicCircle);
        gauges.add(dynamicCircle);

        CorBiCoreReader corbiReader = new CorBiCoreReader(length -> this.updateGauges(length)).setDummy();
        new Thread(corbiReader::read).start();
        stage.setOnCloseRequest(event ->
        {
            corbiReader.destroy();
            System.exit(0);
        });
        stage.setScene(scene);
        stage.show();
    }

    public void updateGauges(double length)
    {
        gauges.forEach(gauge -> gauge.updateLength(length));
    }

    public static void main(String[] args)
    {
        launch();
    }

}
